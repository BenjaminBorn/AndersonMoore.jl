WORD_SIZE := $(shell julia -e "print(Sys.WORD_SIZE)")

ifeq ($(WORD_SIZE), 64)
	INTFLAG = -fdefault-integer-8
else
	INTFLAG =
endif

allCObjs=	   callSparseAim.o sparseAim.o sparskit2.o

allFortObjs=  dgetv0.o dlaqrb.o dmout.o dnaitr.o dnapps.o dnaup2.o dnaupd.o \
dnconv.o dneigh.o dneupd.o dngets.o dsortc.o dstatn.o dvout.o ivout.o \
ma50ad.o second.o

allObjs= $(allFortObjs) $(allCObjs)

%.o: %.f Makefile
	gfortran -m$(WORD_SIZE) $(INTFLAG) -fpic -O3 -pipe -g -c $< -o $@

mylib.so: $(allObjs)
	gcc -std=gnu99 -shared -o mylib.so $(allObjs) -lblas -lgfortran

clean:
	rm -rf *o
